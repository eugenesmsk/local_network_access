# Доступ к локальной сети через роутер Keenetic, подключенный к Wireguard на VPS

Если у вас нет белого IP адреса в домашней сети, но вы при этом хотите иметь доступ к устройствам в локальной сети за роутером Keenetic, эта инструкция для васю
Инструкция разделена на 3 части:
1) Установка Wireguard на VPS
2) Настройка роутера Keenetic
3) Настрока доступа к локальной сети

## Установка Wireguard на VPS.

- Берём в аренду любой VPS и заходим на него по ssh
- Для установки Wireguard я предлагаю использовать скрипт, взятый [отсюда](https://github.com/DigneZzZ/dwg) и использовать установку без графического интерфейса и wg-easy. Обращаю внимание, что при использовании wg-easy при перезагрузке докер-контейнера пересоздаётся конфигурационный файл wg0.conf, что помешает нам отредактировать конфиг таким образом, чтобы был доступ в локальную сеть.
  ### Установка WG:
  Запустить команду на чистом сервере:
  ```
  bash <(wget -qO- https://raw.githubusercontent.com/DigneZzZ/dwg/main/set-up.sh)
  ```
  В ходе установки будут заданы некоторые вопросы:
  - Установить текстовый редактор nano - y
  - Выбираем установку с классическим Wireguard
     ![image](https://github.com/eugenesmsk/local_network_access/assets/41268173/c891e698-9347-464f-bf57-9702ec5ad680)
  - Хотите продолжить установку - y
  - Выбираем способ настройки пиров через имена пользователей (2) и введите имена пользователей. Для примера создаю 3 пользователя, один из которых роутер
    
    ![image](https://github.com/eugenesmsk/local_network_access/assets/41268173/97f9c1b9-f0a3-41e9-b988-ef469126364c)
  - Вводим логин и пароль для AdGuardHome
    ![image](https://github.com/eugenesmsk/local_network_access/assets/41268173/5e0a6134-236f-43cc-8b54-348423a00d1e)
  - На вопрос о замене порта ssh - тут на ваше усмотрение. Можно поменять на другой порт, что усложнит задачу по сканированию портов потенциальному хакеру
  - Дальше вопрос об установке UFW Firewall. Рекомендую его установить и на вопрос о сервисах, к которым нужно открыть доступ ничего не вводит и нажать Enter. В этом случае будет открыт только порт ssh.
 
    Поздравляю, Wireguard установлен. Далее заходим в папку dwg и правим файл peer.sh
    ```
    cd dwg
    nano peer.sh
    ```
    Заменяем путь к файлу конфигурации на следующий и сохраняем файл (F2 -> y -> Enter):
    ```
    wg_conf_path="wireguard/wg_confs/wg0.conf"
    ```
    Теперь можем вывести QR-код и конфигурацию для подключения к VPN:
    ```
    bash peer.sh
    ```
    И вводим номер пользователя. В ответ получаем конфиг:
    ![image](https://github.com/eugenesmsk/local_network_access/assets/41268173/060c4057-5215-41ca-9e28-cc116bfb96d9)

    
